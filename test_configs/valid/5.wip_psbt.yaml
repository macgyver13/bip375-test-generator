description: "Valid in progress PSBT scenarios"

test_cases:
  - description: "WIP: two P2TR inputs - not signed"
    validation_result: "valid"
    inputs:
      - type: "p2tr"
        amount: 100000
        key_derivation_suffix: "input_0"
      - type: "p2tr"
        amount: 10000
        key_derivation_suffix: "input_1"
    outputs:
      - type: "silent_payment"
        amount: 195000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"

  - description: "WIP: no ECDH shares - no PSBT_OUT_SCRIPT"
    validation_result: "valid"
    inputs:
      - type: "p2tr"
        amount: 100000
        key_derivation_suffix: "single_signer_per_input"
    outputs:
      - type: "silent_payment"
        amount: 95000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"
    control_override:
      missing_ecdh_for_input: 0

  - description: "WIP: partial ECDH coverage - no PSBT_OUT_SCRIPT"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 100000
        key_derivation_suffix: "incomplete_input_0"
      - type: "p2wpkh"
        amount: 150000
        key_derivation_suffix: "incomplete_input_1"
    outputs:
      - type: "silent_payment"
        amount: 200000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"
    control_override:
      missing_ecdh_for_input: 1  # Input 1 will not have ECDH share

  - description: "WIP: one input/two sp outputs (different scan keys) - Output 0 missing ECDH share for scan key"
    validation_result: "invalid"
    inputs:
      - type: "p2wpkh"
        amount: 200000
        key_derivation_suffix: "multi_scan_missing_ecdh"
    outputs:
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "scan_key_a"
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "scan_key_b"
    scan_keys:
      - key_id: "scan_key_a"
        derivation_suffix: "recipient_a"
      - key_id: "scan_key_b"
        derivation_suffix: "recipient_b"
    control_override:
      missing_ecdh_for_scan_key: "scan_key_a"