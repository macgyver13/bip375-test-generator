description: "Valid single-signer ECDH share scenarios"

test_cases:
  - description: "can finalize: one P2WPKH input single-signer"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 100000
        key_derivation_suffix: "single_signer_per_input"
    outputs:
      - type: "silent_payment"
        amount: 95000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"

  - description: "can finalize: two inputs single-signer - using global ECDH share"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 100000
        count: 2
        key_derivation_suffix: "single_signer"
    outputs:
      - type: "silent_payment"
        amount: 95000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"
    control_override:
      use_global_ecdh: true
      no_sighash_for_input: 0

  - description: "can finalize: two inputs single-signer - using per-input ECDH shares"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 100000
        count: 2
        key_derivation_suffix: "single_signer_per_input"
    outputs:
      - type: "silent_payment"
        amount: 95000
        scan_key_id: "default"
    scan_keys:
      - key_id: "default"
    control_override:
      no_sighash_for_input: 0

  - description: "can finalize: two inputs/two sp outputs - mixed global and per-input ECDH shares"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 200000
        count: 2
        key_derivation_suffix: "mixed_ecdh"
    outputs:
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "recipient_a"
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "recipient_b"
    scan_keys:
      - key_id: "recipient_a"
        derivation_suffix: "recipient_a"
      - key_id: "recipient_b"
        derivation_suffix: "recipient_b"
    control_override:
      use_global_ecdh: ["recipient_a"]

  - description: "can finalize: three sp outputs (different scan keys) - multiple global ECDH shares"
    validation_result: "valid"
    inputs:
      - type: "p2wpkh"
        amount: 500000
        key_derivation_suffix: "different_key"
      - type: "p2wpkh"
        amount: 100000
        key_derivation_suffix: "different_key"
    outputs:
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "recipient_a"
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "recipient_b"
      - type: "silent_payment"
        amount: 90000
        scan_key_id: "recipient_c"
    scan_keys:
      - key_id: "recipient_a"
        derivation_suffix: "recipient_a"
      - key_id: "recipient_b"
        derivation_suffix: "recipient_b"
      - key_id: "recipient_c"
        derivation_suffix: "recipient_c"
    control_override:
      use_global_ecdh: ["recipient_a", "recipient_b", "recipient_c"]
